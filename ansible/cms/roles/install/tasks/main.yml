- name: Install necessary packages
  become: yes
  become_method: su
  become_user: root
  apt:
          name: "{{ packages }}"
  vars:
          packages:
          - git
          - openjdk-8-jdk-headless
          - postgresql-client
          - python3.6
          - python3.6-dev
          - libpq-dev
          - libcups2-dev
          - libyaml-dev
          - libffi-dev
          - python3-pip
          - cgroup-lite
          - libcap-dev
          - zip

- name: Download CMS from GitHub
  git:
          repo: https://github.com/ioi-2019/cms-ioi2019.git
<<<<<<< HEAD
          version: communication
=======
          version: master
>>>>>>> 76a8205216f1fbd9b59d8218c0b8c83c7dc7e6e2
          dest: /home/{{ansible_user}}/cms
          accept_hostkey: yes
          recursive: yes
  register: git_checkout
  tags: install

- name: Build CMS
  command: "{{ item }}"
  with_items:
          - sudo pip3 install -r requirements.txt
          - sudo python3 setup.py install
  args:
          chdir: /home/{{ ansible_user }}/cms/
  when: git_checkout.changed
  tags: build


